<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Live2D Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: #1e1e1e;
        overflow: hidden;
        font-family: sans-serif;
      }

      #live2d-canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      .info-bar {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        padding: 0.5rem 1rem;
        box-sizing: border-box;
        color: #f0f0f0;
        background: rgba(0, 0, 0, 0.25);
        font-size: 0.9rem;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <canvas id="live2d-canvas"></canvas>
    <div class="info-bar">
      Live2D model: mark_free_t04 â€” click &amp; drag to move, scroll to zoom.
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pixi.js@6.5.8/dist/browser/pixi.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/browser/pixi-live2d-display.min.js"></script>
    <script src="https://cubism.live2d.com/sdk-web/cubismcore/live2dcubismcore.min.js"></script>
    <script>
      const canvas = document.getElementById("live2d-canvas");
      const app = new PIXI.Application({
        view: canvas,
        backgroundAlpha: 0,
        autoDensity: true,
        resolution: window.devicePixelRatio || 1,
      });

      app.renderer.resize(window.innerWidth, window.innerHeight);

      window.addEventListener("resize", () => {
        app.renderer.resize(window.innerWidth, window.innerHeight);
      });

      PIXI.live2d
        .Live2DModel.from("mark_free_t04.model3.json")
        .then((model) => {
          app.stage.addChild(model);

          model.anchor.set(0.5, 0.5);
          model.position.set(
            app.renderer.width * 0.5,
            app.renderer.height * 0.75
          );
          model.scale.set(0.3);

          const dragData = {
            dragging: false,
            pointerId: null,
            offsetX: 0,
            offsetY: 0,
          };

          canvas.addEventListener("pointerdown", (event) => {
            dragData.dragging = true;
            dragData.pointerId = event.pointerId;
            dragData.offsetX = event.clientX - model.position.x;
            dragData.offsetY = event.clientY - model.position.y;
            canvas.setPointerCapture(event.pointerId);
          });

          canvas.addEventListener("pointermove", (event) => {
            if (!dragData.dragging || dragData.pointerId !== event.pointerId) {
              return;
            }
            model.position.set(
              event.clientX - dragData.offsetX,
              event.clientY - dragData.offsetY
            );
          });

          canvas.addEventListener("pointerup", (event) => {
            if (dragData.pointerId === event.pointerId) {
              dragData.dragging = false;
              dragData.pointerId = null;
              canvas.releasePointerCapture(event.pointerId);
            }
          });

          canvas.addEventListener("wheel", (event) => {
            event.preventDefault();
            const scaleDelta = event.deltaY > 0 ? 0.95 : 1.05;
            const newScale = model.scale.x * scaleDelta;
            model.scale.set(Math.min(Math.max(newScale, 0.1), 1.5));
          });
        })
        .catch((error) => {
          console.error("Failed to load Live2D model", error);
        });
    </script>
  </body>
</html>
